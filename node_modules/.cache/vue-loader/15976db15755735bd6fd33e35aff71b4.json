{"remainingRequest":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/robert/project/vue/UniversalVue/UniversalVue/src/views/sys/menu/components/menu-add-or-update.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/src/views/sys/menu/components/menu-add-or-update.vue","mtime":1584947585007},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.mod-menu {\n  .menu-list__input,\n  .icon-list__input {\n    > .el-input__inner {\n      cursor: pointer;\n    }\n  }\n  &__icon-popover {\n    max-width: 370px;\n  }\n  &__icon-list {\n    max-height: 240px;\n    padding: 0;\n    margin: -8px 0 0 -8px;\n    > .el-button {\n      padding: 8px;\n      margin: 8px 0 0 8px;\n      > span {\n        display: inline-block;\n        vertical-align: middle;\n        width: 18px;\n        height: 18px;\n        font-size: 18px;\n      }\n    }\n  }\n  .icon-list__tips {\n    font-size: 18px;\n    text-align: center;\n    color: #e6a23c;\n    cursor: pointer;\n  }\n}\n",{"version":3,"sources":["menu-add-or-update.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"menu-add-or-update.vue","sourceRoot":"src/views/sys/menu/components","sourcesContent":["<template>\n  <el-dialog\n    :title=\"!dataForm.id ? '新增' : '修改'\"\n    :close-on-click-modal=\"false\"\n    :visible.sync=\"visible\">\n    <el-form :model=\"dataForm\" :rules=\"dataRule\" ref=\"dataForm\" @keyup.enter.native=\"dataFormSubmit()\" label-width=\"80px\" size=\"small\">\n      <el-form-item label=\"类型\" prop=\"type\">\n        <el-radio-group v-model=\"dataForm.type\">\n          <el-radio v-for=\"(type, index) in dataForm.typeList\" :label=\"index\" :key=\"index\">{{ type }}</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item :label=\"dataForm.typeList[dataForm.type] + '名称'\" prop=\"name\">\n        <el-input v-model=\"dataForm.name\" :placeholder=\"dataForm.typeList[dataForm.type] + '名称'\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"上级菜单\" prop=\"parentName\">\n        <el-popover\n          ref=\"menuListPopover\"\n          placement=\"bottom-start\"\n          trigger=\"click\">\n          <el-tree\n            :data=\"menuList\"\n            :props=\"menuListTreeProps\"\n            node-key=\"menuId\"\n            ref=\"menuListTree\"\n            @current-change=\"menuListTreeCurrentChangeHandle\"\n            :default-expand-all=\"false\"\n            :highlight-current=\"true\"\n            :expand-on-click-node=\"false\">\n          </el-tree>\n        </el-popover>\n        <el-input v-model=\"dataForm.parentName\" v-popover:menuListPopover :readonly=\"true\" placeholder=\"点击选择上级菜单\" class=\"menu-list__input\"></el-input>\n      </el-form-item>\n      <el-form-item v-if=\"dataForm.type !== 2\" label=\"菜单路由\" prop=\"url\">\n        <el-input v-model=\"dataForm.url\" placeholder=\"菜单路由\"></el-input>\n      </el-form-item>\n      <el-form-item v-if=\"dataForm.type !== 0\" label=\"授权标识\" prop=\"perms\">\n        <el-input v-model=\"dataForm.perms\" placeholder=\"多个用逗号分隔, 如: user:list,user:create\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"排序号\" prop=\"orderNum\">\n        <el-input-number v-model=\"dataForm.orderNum\" controls-position=\"right\" :min=\"0\" label=\"排序号\"></el-input-number>\n      </el-form-item>\n      <el-form-item v-if=\"dataForm.type !== 2\" label=\"菜单图标\" prop=\"icon\">\n        <el-row>\n          <el-col :span=\"24\">\n            <el-popover\n              ref=\"iconListPopover\"\n              placement=\"bottom-start\"\n              trigger=\"click\"\n              popper-class=\"mod-menu__icon-popover\">\n              <div class=\"mod-menu__icon-list\">\n                <el-button\n                  v-for=\"(item, index) in iconList\"\n                  :key=\"index\"\n                  @click=\"iconActiveHandle(item)\"\n                  :class=\"{ 'is-active': item === dataForm.icon }\">\n                  <svg-icon :icon-class=\"item\"></svg-icon>\n                </el-button>\n              </div>\n            </el-popover>\n            <el-input v-model=\"dataForm.icon\" v-popover:iconListPopover :readonly=\"true\" placeholder=\"菜单图标名称\" class=\"icon-list__input\"></el-input>\n          </el-col>\n          <!-- <el-col :span=\"2\" class=\"icon-list__tips\">\n            <el-tooltip placement=\"top\" effect=\"light\">\n              <i class=\"el-icon-warning\"></i>\n            </el-tooltip>\n          </el-col> -->\n        </el-row>\n      </el-form-item>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"visible = false\">取消</el-button>\n      <el-button type=\"primary\" @click=\"dataFormSubmit()\">确定</el-button>\n    </span>\n  </el-dialog>\n</template>\n\n<script>\nimport { treeDataTranslate } from \"@/utils\";\nimport Icon from \"@/icons\";\nimport { menuSelect, menuDataFormSubmit, menuInfo } from \"@/api/sys\";\nexport default {\n  data() {\n    var validateUrl = (rule, value, callback) => {\n      if (this.dataForm.type === 1 && !/\\S/.test(value)) {\n        callback(new Error(\"菜单URL不能为空\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      visible: false,\n      dataForm: {\n        id: 0,\n        type: 1,\n        typeList: [\"目录\", \"菜单\", \"按钮\"],\n        name: \"\",\n        parentId: 0,\n        parentName: \"\",\n        url: \"\",\n        perms: \"\",\n        orderNum: 0,\n        icon: \"\",\n        iconList: []\n      },\n      dataRule: {\n        name: [\n          { required: true, message: \"名称不能为空\", trigger: \"blur\" }\n        ],\n        parentName: [\n          { required: true, message: \"上级菜单不能为空\", trigger: \"change\" }\n        ],\n        url: [{ validator: validateUrl, trigger: \"blur\" }]\n      },\n      menuList: [],\n      menuListTreeProps: {\n        label: \"name\",\n        children: \"children\"\n      }\n    };\n  },\n  created() {\n    this.iconList = Icon.getNameList();\n  },\n  methods: {\n    async init(id) {\n      this.dataForm.id = id || 0;\n      const { data } = await menuSelect();\n      this.menuList = treeDataTranslate(data.menuList, \"menuId\");\n      this.visible = true;\n      await this.$nextTick(() => {\n        this.$refs[\"dataForm\"].resetFields();\n      });\n      if (!this.dataForm.id) {\n        // 新增\n        this.menuListTreeSetCurrentNode();\n      } else {\n        // 修改\n        const { data } = await menuInfo(`/sys/menu/info/${this.dataForm.id}`);\n        this.dataForm.id = data.menu.menuId;\n        this.dataForm.type = data.menu.type;\n        this.dataForm.name = data.menu.name;\n        this.dataForm.parentId = data.menu.parentId;\n        this.dataForm.url = data.menu.url;\n        this.dataForm.perms = data.menu.perms;\n        this.dataForm.orderNum = data.menu.orderNum;\n        this.dataForm.icon = data.menu.icon;\n        this.menuListTreeSetCurrentNode();\n      }\n    },\n    // 菜单树选中\n    menuListTreeCurrentChangeHandle(data, node) {\n      this.dataForm.parentId = data.menuId;\n      this.dataForm.parentName = data.name;\n    },\n    // 菜单树设置当前选中节点\n    menuListTreeSetCurrentNode() {\n      this.$refs.menuListTree.setCurrentKey(this.dataForm.parentId);\n      this.dataForm.parentName = (this.$refs.menuListTree.getCurrentNode() ||\n        {})[\"name\"];\n    },\n    // 图标选中\n    iconActiveHandle(iconName) {\n      this.dataForm.icon = iconName;\n    },\n    // 表单提交\n    dataFormSubmit() {\n      this.$refs[\"dataForm\"].validate(async valid => {\n        if (valid) {\n          const params = {\n            menuId: this.dataForm.id || undefined,\n            type: this.dataForm.type,\n            name: this.dataForm.name,\n            parentId: this.dataForm.parentId,\n            url: this.dataForm.url,\n            perms: this.dataForm.perms,\n            orderNum: this.dataForm.orderNum,\n            icon: this.dataForm.icon\n          };\n          const { data } = await menuDataFormSubmit(\n            `/sys/menu/${!this.dataForm.id ? \"save\" : \"update\"}`,\n            params\n          );\n          if (data && data.code === 0) {\n            this.$message({\n              message: \"操作成功\",\n              type: \"success\",\n              duration: 1500,\n              onClose: () => {\n                this.visible = false;\n                this.$emit(\"refreshDataList\");\n              }\n            });\n          } else {\n            this.$message.error(data.msg);\n          }\n          // this.$http({\n          //   url: this.$http.adornUrl(\n          //     `/sys/menu/${!this.dataForm.id ? \"save\" : \"update\"}`\n          //   ),\n          //   method: \"post\",\n          //   data: this.$http.adornData({\n          //     menuId: this.dataForm.id || undefined,\n          //     type: this.dataForm.type,\n          //     name: this.dataForm.name,\n          //     parentId: this.dataForm.parentId,\n          //     url: this.dataForm.url,\n          //     perms: this.dataForm.perms,\n          //     orderNum: this.dataForm.orderNum,\n          //     icon: this.dataForm.icon\n          //   })\n          // }).then(({ data }) => {\n          //   if (data && data.code === 0) {\n          //     this.$message({\n          //       message: \"操作成功\",\n          //       type: \"success\",\n          //       duration: 1500,\n          //       onClose: () => {\n          //         this.visible = false;\n          //         this.$emit(\"refreshDataList\");\n          //       }\n          //     });\n          //   } else {\n          //     this.$message.error(data.msg);\n          //   }\n          // });\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n.mod-menu {\n  .menu-list__input,\n  .icon-list__input {\n    > .el-input__inner {\n      cursor: pointer;\n    }\n  }\n  &__icon-popover {\n    max-width: 370px;\n  }\n  &__icon-list {\n    max-height: 240px;\n    padding: 0;\n    margin: -8px 0 0 -8px;\n    > .el-button {\n      padding: 8px;\n      margin: 8px 0 0 8px;\n      > span {\n        display: inline-block;\n        vertical-align: middle;\n        width: 18px;\n        height: 18px;\n        font-size: 18px;\n      }\n    }\n  }\n  .icon-list__tips {\n    font-size: 18px;\n    text-align: center;\n    color: #e6a23c;\n    cursor: pointer;\n  }\n}\n</style>\n"]}]}