{"remainingRequest":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/babel-loader/lib/index.js!/Users/robert/project/vue/UniversalVue/UniversalVue/src/permission.js","dependencies":[{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/src/permission.js","mtime":1585101532808},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Users/robert/project/vue/UniversalVue/UniversalVue/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport router from \"./router\";\nimport store from \"./store\";\nimport NProgress from 'nprogress'; // Progress 进度条\n\nimport 'nprogress/nprogress.css'; // Progress 进度条样式\n\nimport { Message } from 'element-ui';\nimport { getToken } from '@/utils/auth'; // 验权\n\nvar whiteList = ['/login']; // 不重定向白名单\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start();\n\n  if (getToken()) {\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n      NProgress.done(); // if current page is dashboard will not trigger\tafterEach hook, so manually handle it\n    } else {\n      if (store.getters.token === '') {\n        // 判断当前用户是否已拉权限信息\n        store.dispatch('setTokenVuex').then(function () {\n          store.dispatch('GenerateRoutes').then(function (res) {\n            // 获取路由信息\n            if (!res) {\n              router.addRoutes(store.getters.addRouters); // 动态添加可访问路由表\n\n              next(_objectSpread({}, to, {\n                replace: true\n              })); // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\n            } else {\n              store.dispatch('FedLogOut').then(function () {\n                // Message.error(err || 'Verification failed, please login again')\n                next({\n                  path: '/'\n                });\n              });\n            }\n          });\n        }).catch(function (err) {\n          console.log(err);\n          store.dispatch('FedLogOut').then(function () {\n            Message.error(err || 'Verification failed, please login again');\n            next({\n              path: '/'\n            });\n          });\n        });\n      } else {\n        next();\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      next();\n    } else {\n      next('/login');\n      NProgress.done();\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done(); // 结束Progress\n});",{"version":3,"sources":["/Users/robert/project/vue/UniversalVue/UniversalVue/src/permission.js"],"names":["router","store","NProgress","Message","getToken","whiteList","beforeEach","to","from","next","start","path","done","getters","token","dispatch","then","res","addRoutes","addRouters","replace","catch","err","console","log","error","indexOf","afterEach"],"mappings":";;;;;;;;;AAAA,OAAOA,MAAP;AACA,OAAOC,KAAP;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAkC;;AAClC,OAAO,yBAAP,C,CAAgC;;AAChC,SAASC,OAAT,QAAwB,YAAxB;AACA,SAASC,QAAT,QAAyB,cAAzB,C,CAAwC;;AAExC,IAAMC,SAAS,GAAG,CAAC,QAAD,CAAlB,C,CAA6B;;AAC7BL,MAAM,CAACM,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpCP,EAAAA,SAAS,CAACQ,KAAV;;AACA,MAAIN,QAAQ,EAAZ,EAAgB;AACd,QAAIG,EAAE,CAACI,IAAH,KAAY,QAAhB,EAA0B;AACxBF,MAAAA,IAAI,CAAC;AAAEE,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAJ;AACAT,MAAAA,SAAS,CAACU,IAAV,GAFwB,CAEP;AAClB,KAHD,MAGO;AACL,UAAIX,KAAK,CAACY,OAAN,CAAcC,KAAd,KAAwB,EAA5B,EAAgC;AAAE;AAChCb,QAAAA,KAAK,CAACc,QAAN,CAAe,cAAf,EAA+BC,IAA/B,CAAoC,YAAM;AACxCf,UAAAA,KAAK,CAACc,QAAN,CAAe,gBAAf,EAAiCC,IAAjC,CAAsC,UAAAC,GAAG,EAAI;AAAE;AAC7C,gBAAI,CAACA,GAAL,EAAU;AACRjB,cAAAA,MAAM,CAACkB,SAAP,CAAiBjB,KAAK,CAACY,OAAN,CAAcM,UAA/B,EADQ,CACmC;;AAC3CV,cAAAA,IAAI,mBAAMF,EAAN;AAAUa,gBAAAA,OAAO,EAAE;AAAnB,iBAAJ,CAFQ,CAEuB;AAChC,aAHD,MAGO;AACLnB,cAAAA,KAAK,CAACc,QAAN,CAAe,WAAf,EAA4BC,IAA5B,CAAiC,YAAM;AACrC;AACAP,gBAAAA,IAAI,CAAC;AAAEE,kBAAAA,IAAI,EAAE;AAAR,iBAAD,CAAJ;AACD,eAHD;AAID;AACF,WAVD;AAWD,SAZD,EAYGU,KAZH,CAYS,UAACC,GAAD,EAAS;AAChBC,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACArB,UAAAA,KAAK,CAACc,QAAN,CAAe,WAAf,EAA4BC,IAA5B,CAAiC,YAAM;AACrCb,YAAAA,OAAO,CAACsB,KAAR,CAAcH,GAAG,IAAI,yCAArB;AACAb,YAAAA,IAAI,CAAC;AAAEE,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACD,WAHD;AAID,SAlBD;AAmBD,OApBD,MAoBO;AACLF,QAAAA,IAAI;AACL;AACF;AACF,GA7BD,MA6BO;AACL,QAAIJ,SAAS,CAACqB,OAAV,CAAkBnB,EAAE,CAACI,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrCF,MAAAA,IAAI;AACL,KAFD,MAEO;AACLA,MAAAA,IAAI,CAAC,QAAD,CAAJ;AACAP,MAAAA,SAAS,CAACU,IAAV;AACD;AACF;AACF,CAvCD;AAyCAZ,MAAM,CAAC2B,SAAP,CAAiB,YAAM;AACrBzB,EAAAA,SAAS,CAACU,IAAV,GADqB,CACJ;AAClB,CAFD","sourcesContent":["import router from './router'\nimport store from './store'\nimport NProgress from 'nprogress' // Progress 进度条\nimport 'nprogress/nprogress.css'// Progress 进度条样式\nimport { Message } from 'element-ui'\nimport { getToken } from '@/utils/auth' // 验权\n\nconst whiteList = ['/login'] // 不重定向白名单\nrouter.beforeEach((to, from, next) => {\n  NProgress.start()\n  if (getToken()) {\n    if (to.path === '/login') {\n      next({ path: '/' })\n      NProgress.done() // if current page is dashboard will not trigger\tafterEach hook, so manually handle it\n    } else {\n      if (store.getters.token === '') { // 判断当前用户是否已拉权限信息\n        store.dispatch('setTokenVuex').then(() => {\n          store.dispatch('GenerateRoutes').then(res => { // 获取路由信息\n            if (!res) {\n              router.addRoutes(store.getters.addRouters) // 动态添加可访问路由表\n              next({ ...to, replace: true }) // hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record\n            } else {\n              store.dispatch('FedLogOut').then(() => {\n                // Message.error(err || 'Verification failed, please login again')\n                next({ path: '/' })\n              })\n            }\n          })\n        }).catch((err) => {\n          console.log(err)\n          store.dispatch('FedLogOut').then(() => {\n            Message.error(err || 'Verification failed, please login again')\n            next({ path: '/' })\n          })\n        })\n      } else {\n        next()\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      next()\n    } else {\n      next('/login')\n      NProgress.done()\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done() // 结束Progress\n})\n"]}]}